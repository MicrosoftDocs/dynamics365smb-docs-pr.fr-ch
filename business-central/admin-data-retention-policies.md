---
title: Nettoyer les données avec des stratégies de rétention | Microsoft Docs
description: Vous pouvez spécifier la fréquence à laquelle vous souhaitez supprimer certains types de données.
author: bholtorf
ms.service: dynamics365-business-central
ms.topic: conceptual
ms.devlang: na
ms.tgt_pltfrm: na
ms.workload: na
ms.search.keywords: delete, data, retention, policy, policies
ms.date: 04/01/2021
ms.author: bholtorf
ms.openlocfilehash: 5b962ed463a37e578371df193bca887774232ba5
ms.sourcegitcommit: c11ad91a389ed72532f5513654fdc7909b20aed9
ms.translationtype: HT
ms.contentlocale: fr-CH
ms.lasthandoff: 04/22/2021
ms.locfileid: "5935351"
---
# <a name="define-retention-policies"></a><span data-ttu-id="d133b-103">Définir des stratégies de rétention</span><span class="sxs-lookup"><span data-stu-id="d133b-103">Define Retention Policies</span></span>
<span data-ttu-id="d133b-104">Les administrateurs peuvent définir des stratégies de rétention pour spécifier à quelle fréquence ils souhaitent que [!INCLUDE[prod_short](includes/prod_short.md)] supprime les données obsolètes dans les tables contenant des entrées de journal et des enregistrements archivés.</span><span class="sxs-lookup"><span data-stu-id="d133b-104">Administrators can define retention policies to specify how frequently they want [!INCLUDE[prod_short](includes/prod_short.md)] to delete outdated data in tables that contain log entries and archived records.</span></span> <span data-ttu-id="d133b-105">Par exemple, le nettoyage des entrées de journal peut faciliter l’utilisation des données réellement pertinentes.</span><span class="sxs-lookup"><span data-stu-id="d133b-105">For example, cleaning up log entries can make it easier to work with the data that's actually relevant.</span></span> <span data-ttu-id="d133b-106">Les stratégies peuvent inclure toutes les données des tables qui ont dépassé la date d’expiration, ou vous pouvez ajouter des critères de filtre qui n’incluront que certaines données expirées dans la stratégie.</span><span class="sxs-lookup"><span data-stu-id="d133b-106">Policies can include all data in the tables that is past the expiration date, or you can add filter criteria that will include only certain expired data in the policy.</span></span> 

## <a name="required-setups-and-permissions"></a><span data-ttu-id="d133b-107">Paramètres et autorisations obligatoires</span><span class="sxs-lookup"><span data-stu-id="d133b-107">Required Setups and Permissions</span></span>
<span data-ttu-id="d133b-108">Avant de pouvoir utiliser des stratégies de rétention, vous devez définir les éléments suivants.</span><span class="sxs-lookup"><span data-stu-id="d133b-108">Before you can create retention policies, you must set up the following.</span></span>

|<span data-ttu-id="d133b-109">Configuration</span><span class="sxs-lookup"><span data-stu-id="d133b-109">Setup</span></span>  |<span data-ttu-id="d133b-110">Description</span><span class="sxs-lookup"><span data-stu-id="d133b-110">Description</span></span>  |
|---------|---------|
|<span data-ttu-id="d133b-111">**Tables autorisées**</span><span class="sxs-lookup"><span data-stu-id="d133b-111">**Allowed Tables**</span></span>     |<span data-ttu-id="d133b-112">Nous fournissons une liste des tables qui peuvent être incluses dans les stratégies de rétention.</span><span class="sxs-lookup"><span data-stu-id="d133b-112">We provide a list of the tables that can be included in retention policies.</span></span> <span data-ttu-id="d133b-113">Cependant, si vous souhaitez ajouter des tables d’une extension à une stratégie de rétention, un développeur doit ajouter leurs tables à la liste.</span><span class="sxs-lookup"><span data-stu-id="d133b-113">However, if you want to add tables from an extension to a retention policy a developer must add their tables to the list.</span></span> <span data-ttu-id="d133b-114">Pour plus d’informations, voir [Inclusion de votre extension dans une stratégie de rétention](admin-data-retention-policies.md#including-your-extension-in-a-retention-policy-requires-help-from-a-developer).</span><span class="sxs-lookup"><span data-stu-id="d133b-114">For more information, see [Including Your Extension in a Retention Policy](admin-data-retention-policies.md#including-your-extension-in-a-retention-policy-requires-help-from-a-developer).</span></span>          |
|<span data-ttu-id="d133b-115">**Périodes de rétention**</span><span class="sxs-lookup"><span data-stu-id="d133b-115">**Retention Periods**</span></span>     |<span data-ttu-id="d133b-116">Spécifiez les périodes pendant lesquelles les données doivent être conservées dans les tables dans une stratégie.</span><span class="sxs-lookup"><span data-stu-id="d133b-116">Specify periods of time for which to keep data in the tables in a policy.</span></span> <span data-ttu-id="d133b-117">Les périodes déterminent la fréquence à laquelle les données seront supprimées.</span><span class="sxs-lookup"><span data-stu-id="d133b-117">The periods determine how often data will be deleted.</span></span>         |

<span data-ttu-id="d133b-118">En outre, vous devez disposer des autorisations d’utilisateur AVANCÉ ou de l’ensemble d’autorisations de configuration de la stratégie de rétention.</span><span class="sxs-lookup"><span data-stu-id="d133b-118">Additionally, you must have the SUPER user permissions or the Retention Policy Setup permission set.</span></span> <span data-ttu-id="d133b-119">Les utilisateurs disposant de l’ensemble d’autorisations de configuration de la stratégie de rétention peuvent définir des stratégies de rétention pour les tables, même s’ils ne disposent pas des autorisations de lecture et de suppression pour ces tables.</span><span class="sxs-lookup"><span data-stu-id="d133b-119">Users who are granted the Retention Policy Setup permission set can define retention policies for tables, even if they do not have Read and Delete permissions for those tables.</span></span> <span data-ttu-id="d133b-120">L’entrée de la file d’attente des tâches doit s’exécuter en tant qu’utilisateur disposant des autorisations nécessaires pour lire et supprimer les données.</span><span class="sxs-lookup"><span data-stu-id="d133b-120">The job queue entry must run as a user with permissions to read and delete the data.</span></span> <span data-ttu-id="d133b-121">Nous vous recommandons de ne pas accorder l’ensemble d’autorisations de configuration de la stratégie de rétention aux utilisateurs qui ne devraient pas être autorisés à supprimer des données.</span><span class="sxs-lookup"><span data-stu-id="d133b-121">We recommend that you do not grant the Retention Policy Setup permission set to users who should not be allowed to delete data.</span></span>

> [!NOTE]
> <span data-ttu-id="d133b-122">Si vous utilisez [!INCLUDE[prod_short](includes/prod_short.md)] en local, et que vous souhaitez essayer les stratégies de rétention dans la base de données de démonstration Cronus, vous devez effectuer certaines opérations.</span><span class="sxs-lookup"><span data-stu-id="d133b-122">If you are using [!INCLUDE[prod_short](includes/prod_short.md)] on-premises, and you want to try out retention policies in the the Cronus demonstration database, there are a few things you need to do.</span></span> <span data-ttu-id="d133b-123">La société de démonstration ne contient pas de tables que vous pouvez utiliser avec des stratégies de rétention, vous devez donc les ajouter.</span><span class="sxs-lookup"><span data-stu-id="d133b-123">The demonstration company does not contain tables that you can use with retention policies, so you need to add them.</span></span> <span data-ttu-id="d133b-124">Pour ce faire, créez une société vierge dans la base de données de démonstration.</span><span class="sxs-lookup"><span data-stu-id="d133b-124">To do that, create a new, blank company in the demonstration database.</span></span> <span data-ttu-id="d133b-125">Dans la nouvelle société, importez le package de configuration RapidStart pour votre pays qui correspond au package standard NAV17.0.W1.ENU.STANDARD.rapidstart.</span><span class="sxs-lookup"><span data-stu-id="d133b-125">In the new company, import the RapidStart configuration package for your country that corresponds to the standard NAV17.0.W1.ENU.STANDARD.rapidstart package.</span></span> <span data-ttu-id="d133b-126">Les données de configuration des stratégies de rétention seront disponibles dans la nouvelle société.</span><span class="sxs-lookup"><span data-stu-id="d133b-126">The setup data for retention policies will be available in the new company.</span></span>

### <a name="to-create-retention-periods"></a><span data-ttu-id="d133b-127">Pour créer des périodes de rétention</span><span class="sxs-lookup"><span data-stu-id="d133b-127">To create retention periods</span></span>
<span data-ttu-id="d133b-128">Les périodes de rétention peuvent être aussi longues ou aussi courtes que vous le souhaitez.</span><span class="sxs-lookup"><span data-stu-id="d133b-128">Retention periods can be as long or as short as you want.</span></span> <span data-ttu-id="d133b-129">Pour créer des périodes de rétention, sur la page **Stratégies de rétention**, utilisez l’action **Durée de rétention**.</span><span class="sxs-lookup"><span data-stu-id="d133b-129">To create retention periods, on the **Retention Policies** page, use the **Retention Period** action.</span></span> <span data-ttu-id="d133b-130">Les périodes que vous définissez seront disponibles pour toutes les stratégies.</span><span class="sxs-lookup"><span data-stu-id="d133b-130">The periods you define will be available for all policies.</span></span>

> [!NOTE]
> <span data-ttu-id="d133b-131">Pour des raisons de conformité, nous avons défini une période de rétention minimale pour certaines tables.</span><span class="sxs-lookup"><span data-stu-id="d133b-131">For compliance reasons, we have defined a minimum retention period for some tables.</span></span> <span data-ttu-id="d133b-132">Si vous définissez une période de rétention plus courte que le minimum requis, un message affichera la période obligatoire.</span><span class="sxs-lookup"><span data-stu-id="d133b-132">If you set a retention period that is shorter than minimum required, a message will display the mandatory period.</span></span>

### <a name="set-up-a-retention-policy"></a><span data-ttu-id="d133b-133">Configurer une stratégie de rétention</span><span class="sxs-lookup"><span data-stu-id="d133b-133">Set up a retention policy</span></span>
1. <span data-ttu-id="d133b-134">Choisissez l’icône ![Ampoule qui ouvre la fonction Tell Me](media/ui-search/search_small.png "Dites-moi ce que vous voulez faire"), entrez **Stratégies de rétention**, puis sélectionnez le lien associé.</span><span class="sxs-lookup"><span data-stu-id="d133b-134">Choose the ![Lightbulb that opens the Tell Me feature](media/ui-search/search_small.png "Tell me what you want to do") icon, enter **Retention Policies**, and choose the related link.</span></span>
2. <span data-ttu-id="d133b-135">Dans le champ **ID table**, sélectionnez la table que vous souhaitez inclure dans la stratégie.</span><span class="sxs-lookup"><span data-stu-id="d133b-135">In the **Table ID** field, choose the table that you want to include in the policy.</span></span>
3. <span data-ttu-id="d133b-136">Dans le champ **Durée de rétention**, spécifiez la durée pendant laquelle conserver les données dans la table.</span><span class="sxs-lookup"><span data-stu-id="d133b-136">In the **Retention Period** field, specify the length of time for which to keep the data in the table.</span></span>
4. <span data-ttu-id="d133b-137">Facultatif : Pour appliquer la stratégie à des données spécifiques dans une table, désactivez le bouton Appliquer à tous les enregistrements.</span><span class="sxs-lookup"><span data-stu-id="d133b-137">Optional: To apply the policy to specific data in a table, turn off the Apply to all records toggle.</span></span> <span data-ttu-id="d133b-138">Le raccourci Stratégie de rétention des enregistrements s’affiche, dans lequel vous pouvez définir des filtres pour créer des sous-jeux de données pour chaque ligne.</span><span class="sxs-lookup"><span data-stu-id="d133b-138">The Record Retention Policy FastTab will display, where you can set filters to create subsets of data for each line.</span></span> <span data-ttu-id="d133b-139">Pour plus d’informations, reportez-vous à la rubrique [Filtrage](ui-enter-criteria-filters.md#filtering).</span><span class="sxs-lookup"><span data-stu-id="d133b-139">For more information, see [Filtering](ui-enter-criteria-filters.md#filtering).</span></span>

   > [!NOTE]
   > <span data-ttu-id="d133b-140">Chaque ligne a sa propre période de rétention.</span><span class="sxs-lookup"><span data-stu-id="d133b-140">Each line has its own retention period.</span></span> <span data-ttu-id="d133b-141">Si vous spécifiez des périodes de rétention différentes pour les mêmes données, la période la plus longue sera utilisée.</span><span class="sxs-lookup"><span data-stu-id="d133b-141">If you specify different retention periods for the same data, the longest period will be used.</span></span> <span data-ttu-id="d133b-142">En outre, certaines tables contiennent des filtres que vous ne pouvez ni modifier ni supprimer.</span><span class="sxs-lookup"><span data-stu-id="d133b-142">Also, some tables contain filters that you cannot change or remove.</span></span> <span data-ttu-id="d133b-143">Pour vous aider à identifier ces filtres, ils apparaissent dans une police de couleur plus claire.</span><span class="sxs-lookup"><span data-stu-id="d133b-143">To help you identify these filters, they appear in a lighter color font.</span></span>

## <a name="applying-retention-policies"></a><span data-ttu-id="d133b-144">Application des stratégies de rétention</span><span class="sxs-lookup"><span data-stu-id="d133b-144">Applying Retention Policies</span></span>
<span data-ttu-id="d133b-145">Vous pouvez utiliser une entrée de file d’attente de tâches pour appliquer des stratégies de rétention afin de supprimer automatiquement les données, ou vous pouvez appliquer manuellement des stratégies.</span><span class="sxs-lookup"><span data-stu-id="d133b-145">You can use a job queue entry to apply retention policies to delete data automatically, or you can manually apply policies.</span></span>

<span data-ttu-id="d133b-146">Pour appliquer automatiquement une stratégie de rétention, créez et activez simplement une stratégie.</span><span class="sxs-lookup"><span data-stu-id="d133b-146">To apply a retention policy automatically, just create and enable a policy.</span></span> <span data-ttu-id="d133b-147">Lorsque vous activez une stratégie, nous créons une entrée de file d’attente de tâches qui appliquera les stratégies de rétention en fonction de la période de rétention que vous spécifiez.</span><span class="sxs-lookup"><span data-stu-id="d133b-147">When you enable a policy we create a job queue entry that will apply retention policies according to the retention period you specify.</span></span> <span data-ttu-id="d133b-148">Toutes les stratégies de rétention utiliseront la même entrée de file d’attente de tâches.</span><span class="sxs-lookup"><span data-stu-id="d133b-148">All retention policies will use the same job queue entry.</span></span> <span data-ttu-id="d133b-149">Par défaut, l’entrée de la file d’attente des tâches applique la stratégie tous les jours à 02 h 00.</span><span class="sxs-lookup"><span data-stu-id="d133b-149">By default, the job queue entry applies the policy every day at 0200.</span></span> <span data-ttu-id="d133b-150">Vous pouvez modifier la valeur par défaut, mais si vous le faites, nous vous recommandons de l’exécuter en dehors des heures d’ouverture.</span><span class="sxs-lookup"><span data-stu-id="d133b-150">You can change the default, but if you do we recommend that it runs outside business hours.</span></span> <span data-ttu-id="d133b-151">Pour en savoir plus, consultez [Utiliser des files d’attente des travaux pour planifier des tâches](admin-job-queues-schedule-tasks.md).</span><span class="sxs-lookup"><span data-stu-id="d133b-151">For more information, see [Use Job Queues to Schedule Tasks](admin-job-queues-schedule-tasks.md).</span></span> 

<span data-ttu-id="d133b-152">Vous pouvez appliquer manuellement une stratégie en utilisant l’action **Appliquer manuellement** sur la page **Stratégies de rétention**.</span><span class="sxs-lookup"><span data-stu-id="d133b-152">You can manually apply a policy by using the **Apply Manually** action on the **Retention Policies** page.</span></span> <span data-ttu-id="d133b-153">Si vous souhaitez toujours appliquer une stratégie manuellement, activez le bouton de basculement **Manuel**.</span><span class="sxs-lookup"><span data-stu-id="d133b-153">If you want to always apply a policy manually, turn on the **Manual** toggle.</span></span> <span data-ttu-id="d133b-154">L’entrée de la file d’attente des tâches ne tiendra pas compte de la stratégie lors de son exécution.</span><span class="sxs-lookup"><span data-stu-id="d133b-154">The job queue entry will disregard the policy when it runs.</span></span>

## <a name="viewing-retention-policy-log-entries"></a><span data-ttu-id="d133b-155">Affichage des entrées du journal des stratégies de rétention</span><span class="sxs-lookup"><span data-stu-id="d133b-155">Viewing Retention Policy Log Entries</span></span>
<span data-ttu-id="d133b-156">Vous pouvez afficher l’activité liée aux stratégies de rétention dans la page **Journal des stratégies de rétention**.</span><span class="sxs-lookup"><span data-stu-id="d133b-156">You can view activity related to retention policies in the **Retention Policy Log** page.</span></span> <span data-ttu-id="d133b-157">Par exemple, des entrées sont créées lorsqu’une stratégie est appliquée ou si des erreurs se sont produites lorsque cela s’est produit.</span><span class="sxs-lookup"><span data-stu-id="d133b-157">For example, entries are created when when a policy is applied, or if errors occurred when that happened.</span></span> 

## <a name="including-your-extension-in-a-retention-policy-requires-help-from-a-developer"></a><span data-ttu-id="d133b-158">Inclusion de votre extension dans une stratégies de rétention (nécessite l’aide d’un développeur)</span><span class="sxs-lookup"><span data-stu-id="d133b-158">Including Your Extension in a Retention Policy (Requires Help from a Developer)</span></span>
<span data-ttu-id="d133b-159">Par défaut, les stratégies de rétention couvrent uniquement les tables incluses dans la liste des tableaux [!INCLUDE[prod_short](includes/prod_short.md)] que nous fournissons.</span><span class="sxs-lookup"><span data-stu-id="d133b-159">By default, retention policies cover only tables that are included in the list of [!INCLUDE[prod_short](includes/prod_short.md)] tables that we provide.</span></span> <span data-ttu-id="d133b-160">Vous pouvez supprimer les tables par défaut de la liste et ajouter des tables qui vous appartiennent.</span><span class="sxs-lookup"><span data-stu-id="d133b-160">You can remove default tables from the list, and you can add tables that you own.</span></span> <span data-ttu-id="d133b-161">Autrement dit, vous ne pouvez pas ajouter une table que vous n’avez pas créée vous-même.</span><span class="sxs-lookup"><span data-stu-id="d133b-161">That is, you cannot add a table that you did not create yourself.</span></span> <span data-ttu-id="d133b-162">Par exemple, vous ne pouvez pas ajouter d’autres tables à partir de [!INCLUDE[prod_short](includes/prod_short.md)] ou à partir d’une extension que vous avez achetée.</span><span class="sxs-lookup"><span data-stu-id="d133b-162">For example, you cannot add other tables from [!INCLUDE[prod_short](includes/prod_short.md)] or from an extension that you have purchased.</span></span>

<span data-ttu-id="d133b-163">Pour ajouter vos tables à la liste des tables autorisées, un développeur doit ajouter du code, par exemple au codeunit d’installation de l’extension (un codeunit avec le sous-type *install*).</span><span class="sxs-lookup"><span data-stu-id="d133b-163">To add your tables to the list of allowed tables, a developer must add some code, for example to the installer codeunit for the extension (a codeunit with the *install* subtype).</span></span> 

<span data-ttu-id="d133b-164">Lorsqu’un développeur ajoute une table, il peut spécifier des filtres obligatoires et par défaut.</span><span class="sxs-lookup"><span data-stu-id="d133b-164">When a developer adds a table, they can specify mandatory and default filters.</span></span> <span data-ttu-id="d133b-165">Les filtres obligatoires ne peuvent pas être supprimés ou modifiés ultérieurement lorsque vous ajoutez des tables pour définir une stratégie de rétention.</span><span class="sxs-lookup"><span data-stu-id="d133b-165">Mandatory filters cannot be removed or modified later when you add tables to define a retention policy.</span></span> <span data-ttu-id="d133b-166">Les filtres par défaut ne sont que des suggestions conviviales.</span><span class="sxs-lookup"><span data-stu-id="d133b-166">Default filters are just friendly suggestions.</span></span>

<span data-ttu-id="d133b-167">Voici des exemples de la façon d’ajouter une table à la liste des tables autorisées avec et sans filtres obligatoires ou par défaut.</span><span class="sxs-lookup"><span data-stu-id="d133b-167">The following are examples of how to add a table to the list of allowed tables with, and without, mandatory or default filters.</span></span> <span data-ttu-id="d133b-168">Pour un exemple plus complexe, voir codeunit 3999 « Reten.</span><span class="sxs-lookup"><span data-stu-id="d133b-168">For a more complex example, see codeunit 3999 "Reten.</span></span> <span data-ttu-id="d133b-169">Pol.</span><span class="sxs-lookup"><span data-stu-id="d133b-169">Pol.</span></span> <span data-ttu-id="d133b-170">Install – BaseApp ».</span><span class="sxs-lookup"><span data-stu-id="d133b-170">Install - BaseApp".</span></span> 

```al
 trigger OnInstallAppPerCompany()
    var
        RetenPolAllowedTables: Codeunit "Reten. Pol. Allowed Tables";
    begin
        RetenPolAllowedTables.AddAllowedTable(Database::"Retention Policy Log Entry");
    end;
```

<span data-ttu-id="d133b-171">L’exemple suivant inclut un filtre obligatoire.</span><span class="sxs-lookup"><span data-stu-id="d133b-171">The following example includes a mandatory filter.</span></span>

```al
 trigger OnInstallAppPerCompany()
    var
        ChangeLogEntry: Record "Change Log Entry";
        RetenPolAllowedTables: Codeunit "Reten. Pol. Allowed Tables";
        RetentionPeriod: Enum "Retention Period Enum";
        RecRef: RecordRef;
        TableFilters: JsonArray;
        Enabled: Boolean;
        Mandatory: Boolean;
    begin
        ChangeLogEntry.Reset();
        ChangeLogEntry.SetFilter("Field Log Entry Feature", '%1|%2', ChangeLogEntry."Field Log Entry Feature"::"Monitor Sensitive Fields", ChangeLogEntry."Field Log Entry Feature"::All);
        RecRef.GetTable(ChangeLogEntry);
        Enabled := true;
        Mandatory := true;
        RetenPolAllowedTables.AddTableFilterToJsonArray(TableFilters, RetentionPeriod::"28 Days", ChangeLogEntry.FieldNo(SystemCreatedAt), Enabled, Mandatory, RecRef);
        RetenPolAllowedTables.AddAllowedTable(Database::"Change Log Entry", ChangeLogEntry.FieldNo(SystemCreatedAt), TableFilters);
    end;
```

<span data-ttu-id="d133b-172">Une fois qu’un développeur a ajouté des tables à la liste, un administrateur peut les inclure dans une stratégie de rétention.</span><span class="sxs-lookup"><span data-stu-id="d133b-172">After a developer has added tables to the list, an administrator can include them in a retention policy.</span></span> 

## <a name="see-also"></a><span data-ttu-id="d133b-173">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="d133b-173">See Also</span></span>

[<span data-ttu-id="d133b-174">Analyse de la télémétrie de suivi des stratégies de rétention</span><span class="sxs-lookup"><span data-stu-id="d133b-174">Analyzing Retention Policy Trace Telemetry</span></span>](/dynamics365/business-central/dev-itpro/administration/telemetry-retention-policy-trace)  
[<span data-ttu-id="d133b-175">Audit des modifications dans Business Central</span><span class="sxs-lookup"><span data-stu-id="d133b-175">Auditing Changes in Business Central</span></span>](across-log-changes.md)  
[<span data-ttu-id="d133b-176">Filtrage</span><span class="sxs-lookup"><span data-stu-id="d133b-176">Filtering</span></span>](ui-enter-criteria-filters.md#filtering)  
[<span data-ttu-id="d133b-177">Utiliser des files d’attente des travaux pour planifier des tâches</span><span class="sxs-lookup"><span data-stu-id="d133b-177">Use Job Queues to Schedule Tasks</span></span>](admin-job-queues-schedule-tasks.md)  
<span data-ttu-id="d133b-178">[Utilisation de [!INCLUDE[prod_short](includes/prod_short.md)]](ui-work-product.md)</span><span class="sxs-lookup"><span data-stu-id="d133b-178">[Working with [!INCLUDE[prod_short](includes/prod_short.md)]](ui-work-product.md)</span></span>  

[!INCLUDE[footer-include](includes/footer-banner.md)]